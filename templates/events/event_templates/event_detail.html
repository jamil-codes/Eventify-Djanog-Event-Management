{% extends 'base.html' %}

{% block title %}
  {{ event.title }} by {{ event.organizer.name }} - Eventify
{% endblock %}

{% block body %}
  <div class="mx-auto max-w-[1200px] w-[95%] my-12">
    <!-- Event Image -->
    {% if event.image %}
      <figure class="aspect-[16/9] overflow-hidden rounded-xl shadow-md mb-8">
        <img src="{{ event.image.url }}" alt="{{ event.title }}" class="w-full h-full object-cover" />
      </figure>
    {% endif %}

    <!-- Title + Organizer Controls -->
    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6">
      <h1 class="text-4xl md:text-5xl font-extrabold leading-tight tracking-wide">{{ event.title }}</h1>
      {% if can_add_ticket %}
        <div class="flex gap-2">
          <a href="{% url 'events:edit_event' event.pk %}" class="btn btn-primary btn-sm">Edit Event</a>
          <a href="{% url 'events:delete_event' event.pk %}" class="btn btn-error btn-sm">Delete Event</a>
          <a href="{% url 'events:add_ticket_type' event.pk %}" class="btn btn-secondary btn-sm">Add Ticket Type</a>
        </div>
      {% endif %}
    </div>

    <!-- Event Info -->
    <div class="text-lg space-y-4 mb-8">
      <p class="flex items-center gap-2">
        <span class="font-medium">üìç Location:</span> {{ event.location }}
      </p>
      <p class="flex items-center gap-2">
        <span class="font-medium">üóì Date & Time:</span> {{ event.start_time|date:'M d, Y ¬∑ H:i' }}
      </p>
    </div>

    <!-- Description -->
    <div class="prose max-w-none mb-10">
      <p>{{ event.description|linebreaks }}</p>
    </div>

    <!-- Organizer Section -->
    <div class="border-t border-base-200 pt-6 flex items-center gap-4">
      <a href="{% url 'authentication:profile' event.organizer.username %}" class="flex items-center gap-3 hover:bg-base-200/40 transition rounded-md p-2 -m-2">
        {% if event.organizer.profile_pic %}
          <div class="avatar">
            <div class="w-12 h-12 rounded-full">
              <img src="{{ event.organizer.profile_pic.url }}" alt="{{ event.organizer.name }}" />
            </div>
          </div>
        {% endif %}
        <div>
          <p class="text-base font-medium">{{ event.organizer.name }}</p>
          <p class="text-sm text-base-content/70">{{ event.organizer.tagline|default:'Organizer' }}</p>
        </div>
      </a>
    </div>

    <div class="border-t border-base-300 my-14"></div>

    <!-- Ticket Types -->
    {% if ticket_types %}
      <div class="bg-base-100 pb-16 px-4 w-full mx-auto mt-12">
        <div class="flex items-center justify-between mb-12">
          <h2 class="text-3xl font-bold text-center">Available Tickets</h2>
          {% if can_add_ticket %}
            <a href="{% url 'events:add_ticket_type' event.pk %}" class="btn btn-outline btn-sm">+ Add Ticket Type</a>
          {% endif %}
        </div>

        <div class="mx-auto w-full grid gap-6 justify-center items-start place-items-center grid-cols-[repeat(auto-fit,minmax(280px,max-content))]">
          {% for ticket_type in ticket_types %}
            <!-- Card -->
            <div class="card bg-base-200 shadow-md border border-base-300 hover:shadow-xl transition-transform duration-300 hover:-translate-y-2 w-full max-w-sm h-full flex flex-col">
              <div class="card-body text-center flex flex-col flex-1">
                <h2 class="uppercase text-sm font-medium tracking-widest text-primary">{{ ticket_type.name }}</h2>
                <h1 class="text-4xl font-bold pb-4 mb-4 border-b border-base-300">${{ ticket_type.price }}</h1>
                <p class="text-base mb-4 flex-1">{{ ticket_type.description|default:'No description provided.' }}</p>
                <p class="text-sm mb-6">
                  {% if ticket_type.quantity_available == 0 %}
                    <span class="text-error font-semibold">Sold Out</span>
                  {% elif ticket_type.quantity_available < 10 %}
                    <span class="text-warning font-semibold">Only {{ ticket_type.quantity_available }} left ‚Äî hurry!</span>
                  {% else %}
                    <span class="text-success">{{ ticket_type.quantity_available }} tickets available</span>
                  {% endif %}
                </p>

                <div class="card-actions mt-auto w-full flex flex-col gap-2">
                  <!-- Buyer Buttons -->
                  {% if ticket_type.quantity_available > 0 %}
                    <a href="" class="btn btn-success w-full">
                      <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path d="M5 12h14M12 5l7 7-7 7" />
                      </svg>Buy Now
                    </a>
                  {% else %}
                    <button class="btn btn-disabled w-full">
                      <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path d="M6 18L18 6M6 6l12 12" />
                      </svg>Sold Out
                    </button>
                  {% endif %}

                  <!-- Owner Controls -->
                  {% if can_add_ticket %}
                    <div class="flex gap-2 w-full mt-5">
                      <a href="{% url 'events:edit_ticket_type' event.pk ticket_type.pk %}" class="btn btn-primary btn-sm w-1/2 flex items-center justify-center gap-1">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path d="M15.232 5.232l3.536 3.536M9 11l3 3L20.485 8.515a2.121 2.121 0 0 0-3-3L9 11zm-4 9h16" />
                        </svg>Edit
                      </a>
                      <a href="{% url 'events:delete_ticket_type' event.pk ticket_type.pk %}" class="btn btn-error btn-sm w-1/2 flex items-center justify-center gap-1">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path d="M6 18L18 6M6 6l12 12" />
                        </svg>Delete
                      </a>
                    </div>
                  {% endif %}
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
    {% else %}
      <p class="mt-10 text-center text-base-content/70">No tickets available for this event.</p>
      {% if can_add_ticket %}
        <div class="text-center mt-6">
          <a href="{% url 'events:add_ticket_type' event.pk %}" class="btn btn-secondary">+ Add Ticket Type</a>
        </div>
      {% endif %}
    {% endif %}
  </div>
{% endblock %}
